# README Backend - Sistema de Gerenciamento de Gruas

## üìã Status Atual do Backend

### ‚úÖ **IMPLEMENTADO**
- Estrutura b√°sica do servidor (Express.js)
- Sistema de autentica√ß√£o JWT
- Middleware de autentica√ß√£o
- Conex√£o com PostgreSQL
- Estrutura de rotas b√°sica

### ‚ùå **PENDENTE - CR√çTICO**

## üóÑÔ∏è **1. BANCO DE DADOS**

### Schema Completo
**Arquivo:** `backend-api/database/schema.sql` ‚úÖ **CRIADO**

**Tabelas Implementadas:**
- ‚úÖ `users` - Usu√°rios do sistema
- ‚úÖ `funcionarios` - Funcion√°rios
- ‚úÖ `clientes` - Clientes
- ‚úÖ `obras` - Obras
- ‚úÖ `gruas` - Gruas
- ‚úÖ `registros_ponto` - Ponto eletr√¥nico
- ‚úÖ `justificativas` - Justificativas
- ‚úÖ `estoque` - Estoque
- ‚úÖ `contas_receber` - Contas a receber
- ‚úÖ `contas_pagar` - Contas a pagar
- ‚úÖ `transferencias_bancarias` - Transfer√™ncias
- ‚úÖ `notificacoes` - Notifica√ß√µes
- ‚úÖ `assinaturas_digitais` - Assinaturas
- ‚úÖ `relatorios` - Relat√≥rios
- ‚úÖ `configuracoes` - Configura√ß√µes

### Migra√ß√µes Pendentes
```sql
-- Executar no PostgreSQL
\i backend-api/database/schema.sql
```

## üîå **2. APIs FALTANTES**

### **2.1 Sistema Financeiro**
```javascript
// backend-api/src/routes/financeiro.js

// ‚ùå PENDENTE: GET /api/financeiro/dashboard
// ‚ùå PENDENTE: GET /api/financeiro/fluxo-caixa
// ‚ùå PENDENTE: POST /api/financeiro/transferencia
// ‚ùå PENDENTE: GET /api/financeiro/contas-receber
// ‚ùå PENDENTE: GET /api/financeiro/contas-pagar
// ‚ùå PENDENTE: POST /api/financeiro/contas-receber
// ‚ùå PENDENTE: POST /api/financeiro/contas-pagar
// ‚ùå PENDENTE: PUT /api/financeiro/contas-receber/:id
// ‚ùå PENDENTE: PUT /api/financeiro/contas-pagar/:id
```

### **2.2 Ponto Eletr√¥nico**
```javascript
// backend-api/src/routes/ponto-eletronico.js

// ‚ùå PENDENTE: GET /api/ponto-eletronico/registros
// ‚ùå PENDENTE: POST /api/ponto-eletronico/registrar
// ‚ùå PENDENTE: GET /api/ponto-eletronico/espelho-ponto
// ‚ùå PENDENTE: POST /api/ponto-eletronico/justificativa
// ‚ùå PENDENTE: GET /api/ponto-eletronico/justificativas
// ‚ùå PENDENTE: PUT /api/ponto-eletronico/justificativa/:id/aprovar
// ‚ùå PENDENTE: POST /api/ponto-eletronico/espelho-ponto/enviar-email
```

### **2.3 Gest√£o de Gruas**
```javascript
// backend-api/src/routes/gruas.js

// ‚ùå PENDENTE: GET /api/gruas
// ‚ùå PENDENTE: POST /api/gruas
// ‚ùå PENDENTE: GET /api/gruas/:id
// ‚ùå PENDENTE: PUT /api/gruas/:id
// ‚ùå PENDENTE: DELETE /api/gruas/:id
// ‚ùå PENDENTE: POST /api/gruas/:id/manutencao
// ‚ùå PENDENTE: GET /api/gruas/:id/historico
```

### **2.4 Gest√£o de Obras**
```javascript
// backend-api/src/routes/obras.js

// ‚ùå PENDENTE: GET /api/obras
// ‚ùå PENDENTE: POST /api/obras
// ‚ùå PENDENTE: GET /api/obras/:id
// ‚ùå PENDENTE: PUT /api/obras/:id
// ‚ùå PENDENTE: DELETE /api/obras/:id
// ‚ùå PENDENTE: POST /api/obras/:id/gruas
// ‚ùå PENDENTE: DELETE /api/obras/:id/gruas/:gruaId
```

### **2.5 Gest√£o de Funcion√°rios**
```javascript
// backend-api/src/routes/funcionarios.js

// ‚ùå PENDENTE: GET /api/funcionarios
// ‚ùå PENDENTE: POST /api/funcionarios
// ‚ùå PENDENTE: GET /api/funcionarios/:id
// ‚ùå PENDENTE: PUT /api/funcionarios/:id
// ‚ùå PENDENTE: DELETE /api/funcionarios/:id
// ‚ùå PENDENTE: GET /api/funcionarios/:id/ponto
// ‚ùå PENDENTE: GET /api/funcionarios/:id/relatorios
```

### **2.6 Gest√£o de Clientes**
```javascript
// backend-api/src/routes/clientes.js

// ‚ùå PENDENTE: GET /api/clientes
// ‚ùå PENDENTE: POST /api/clientes
// ‚ùå PENDENTE: GET /api/clientes/:id
// ‚ùå PENDENTE: PUT /api/clientes/:id
// ‚ùå PENDENTE: DELETE /api/clientes/:id
// ‚ùå PENDENTE: GET /api/clientes/:id/obras
```

### **2.7 Gest√£o de Estoque**
```javascript
// backend-api/src/routes/estoque.js

// ‚ùå PENDENTE: GET /api/estoque
// ‚ùå PENDENTE: POST /api/estoque
// ‚ùå PENDENTE: GET /api/estoque/:id
// ‚ùå PENDENTE: PUT /api/estoque/:id
// ‚ùå PENDENTE: DELETE /api/estoque/:id
// ‚ùå PENDENTE: POST /api/estoque/:id/movimentacao
// ‚ùå PENDENTE: GET /api/estoque/:id/movimentacoes
```

### **2.8 Sistema de Notifica√ß√µes**
```javascript
// backend-api/src/routes/notificacoes.js

// ‚ùå PENDENTE: GET /api/notificacoes
// ‚ùå PENDENTE: POST /api/notificacoes
// ‚ùå PENDENTE: PUT /api/notificacoes/:id/lida
// ‚ùå PENDENTE: DELETE /api/notificacoes/:id
// ‚ùå PENDENTE: POST /api/notificacoes/push/enviar
// ‚ùå PENDENTE: GET /api/notificacoes/nao-lidas
```

### **2.9 Sistema de Exporta√ß√£o**
```javascript
// backend-api/src/routes/exportar.js

// ‚ùå PENDENTE: POST /api/exportar/gruas
// ‚ùå PENDENTE: POST /api/exportar/obras
// ‚ùå PENDENTE: POST /api/exportar/funcionarios
// ‚ùå PENDENTE: POST /api/exportar/financeiro
// ‚ùå PENDENTE: POST /api/exportar/estoque
// ‚ùå PENDENTE: POST /api/exportar/ponto
// ‚ùå PENDENTE: POST /api/exportar/relatorios
```

### **2.10 Sistema de Assinaturas**
```javascript
// backend-api/src/routes/assinaturas.js

// ‚ùå PENDENTE: POST /api/assinaturas/validar
// ‚ùå PENDENTE: POST /api/assinaturas/salvar
// ‚ùå PENDENTE: GET /api/assinaturas/:id
// ‚ùå PENDENTE: GET /api/assinaturas/documento/:tipo/:id
```

## üìä **3. DADOS MOCKADOS FALTANTES**

### **3.1 Dados de Funcion√°rios**
```javascript
// backend-api/src/data/mock-funcionarios.js

const funcionariosMock = [
  {
    id: 1,
    nome: "Jo√£o Silva",
    cpf: "123.456.789-00",
    cargo: "Operador de Grua",
    salario: 3500.00,
    data_admissao: "2023-01-15",
    status: "ativo"
  },
  {
    id: 2,
    nome: "Maria Santos",
    cpf: "987.654.321-00",
    cargo: "Supervisora",
    salario: 4500.00,
    data_admissao: "2022-06-10",
    status: "ativo"
  }
  // ... mais funcion√°rios
];
```

### **3.2 Dados de Clientes**
```javascript
// backend-api/src/data/mock-clientes.js

const clientesMock = [
  {
    id: 1,
    nome: "Construtora ABC Ltda",
    cnpj: "12.345.678/0001-90",
    telefone: "(11) 99999-9999",
    email: "contato@construtoraabc.com",
    status: "ativo"
  }
  // ... mais clientes
];
```

### **3.3 Dados de Obras**
```javascript
// backend-api/src/data/mock-obras.js

const obrasMock = [
  {
    id: 1,
    nome: "Edif√≠cio Residencial Horizonte",
    endereco: "Rua das Flores, 123 - S√£o Paulo/SP",
    cliente_id: 1,
    data_inicio: "2024-01-15",
    data_fim: "2024-12-31",
    status: "ativa",
    valor_total: 1500000.00
  }
  // ... mais obras
];
```

### **3.4 Dados de Gruas**
```javascript
// backend-api/src/data/mock-gruas.js

const gruasMock = [
  {
    id: 1,
    nome: "Grua 001",
    modelo: "Liebherr 1000",
    capacidade: 1000.00,
    altura_maxima: 50.00,
    alcance_maximo: 40.00,
    status: "disponivel",
    obra_atual_id: null
  }
  // ... mais gruas
];
```

### **3.5 Dados de Ponto Eletr√¥nico**
```javascript
// backend-api/src/data/mock-ponto.js

const registrosPontoMock = [
  {
    id: 1,
    funcionario_id: 1,
    data: "2024-10-15",
    entrada: "08:00",
    saida_almoco: "12:00",
    volta_almoco: "13:00",
    saida: "17:00",
    horas_trabalhadas: 8.00,
    horas_extras: 0.00,
    status: "completo"
  }
  // ... mais registros
];
```

### **3.6 Dados Financeiros**
```javascript
// backend-api/src/data/mock-financeiro.js

const dadosFinanceirosMock = {
  receberHoje: 15000.00,
  pagarHoje: 8500.00,
  recebimentosAtraso: 2500.00,
  pagamentosAtraso: 1200.00,
  saldoAtual: 125000.00,
  fluxoCaixa: [
    { mes: "Jan", entrada: 45000, saida: 38000 },
    { mes: "Fev", entrada: 52000, saida: 41000 },
    { mes: "Mar", entrada: 48000, saida: 39000 }
  ],
  transferencias: [
    {
      id: 1,
      data: "2024-10-15",
      valor: 5000.00,
      tipo: "entrada",
      descricao: "Pagamento cliente ABC",
      status: "confirmada"
    }
  ]
};
```

### **3.7 Dados de Estoque**
```javascript
// backend-api/src/data/mock-estoque.js

const estoqueMock = [
  {
    id: 1,
    nome: "Cabo de A√ßo 12mm",
    categoria: "Equipamentos",
    quantidade: 150,
    quantidade_minima: 20,
    preco_unitario: 25.50,
    fornecedor: "Fornecedor ABC"
  }
  // ... mais itens
];
```

## üîß **4. IMPLEMENTA√á√ïES NECESS√ÅRIAS**

### **4.1 Middleware de Valida√ß√£o**
```javascript
// backend-api/src/middleware/validation.js
// ‚ùå PENDENTE: Valida√ß√£o de dados de entrada
// ‚ùå PENDENTE: Sanitiza√ß√£o de dados
// ‚ùå PENDENTE: Valida√ß√£o de tipos
```

### **4.2 Sistema de Logs**
```javascript
// backend-api/src/middleware/logging.js
// ‚ùå PENDENTE: Log de requisi√ß√µes
// ‚ùå PENDENTE: Log de erros
// ‚ùå PENDENTE: Log de auditoria
```

### **4.3 Sistema de Cache**
```javascript
// backend-api/src/middleware/cache.js
// ‚ùå PENDENTE: Cache de consultas frequentes
// ‚ùå PENDENTE: Invalida√ß√£o de cache
```

### **4.4 Sistema de Backup**
```javascript
// backend-api/src/utils/backup.js
// ‚ùå PENDENTE: Backup autom√°tico
// ‚ùå PENDENTE: Restaura√ß√£o de backup
```

### **4.5 Sistema de Relat√≥rios**
```javascript
// backend-api/src/services/relatorios.js
// ‚ùå PENDENTE: Gera√ß√£o de PDFs
// ‚ùå PENDENTE: Gera√ß√£o de Excel
// ‚ùå PENDENTE: Envio por e-mail
```

## üìß **5. INTEGRA√á√ïES FALTANTES**

### **5.1 Sistema de E-mail**
```javascript
// backend-api/src/services/email.js
// ‚ùå PENDENTE: Configura√ß√£o SMTP
// ‚ùå PENDENTE: Templates de e-mail
// ‚ùå PENDENTE: Envio autom√°tico
```

### **5.2 Sistema de WhatsApp**
```javascript
// backend-api/src/services/whatsapp.js
// ‚ùå PENDENTE: Integra√ß√£o WhatsApp Business API
// ‚ùå PENDENTE: Envio de mensagens
// ‚ùå PENDENTE: Webhook de recebimento
```

### **5.3 Sistema de Notifica√ß√µes Push**
```javascript
// backend-api/src/services/push-notifications.js
// ‚ùå PENDENTE: Configura√ß√£o FCM
// ‚ùå PENDENTE: Envio de notifica√ß√µes
// ‚ùå PENDENTE: Gerenciamento de tokens
```

### **5.4 Sistema de Geolocaliza√ß√£o**
```javascript
// backend-api/src/services/geolocation.js
// ‚ùå PENDENTE: Valida√ß√£o de localiza√ß√£o
// ‚ùå PENDENTE: C√°lculo de dist√¢ncias
// ‚ùå PENDENTE: Verifica√ß√£o de presen√ßa
```

## üöÄ **6. PLANO DE IMPLEMENTA√á√ÉO**

### **Fase 1 - Cr√≠tica (1-2 semanas)**
1. ‚úÖ **Banco de dados** - Schema completo
2. ‚ùå **APIs b√°sicas** - CRUD para todas as entidades
3. ‚ùå **Dados mockados** - Dados de desenvolvimento
4. ‚ùå **Autentica√ß√£o** - Sistema JWT completo

### **Fase 2 - Importante (2-3 semanas)**
1. ‚ùå **Sistema financeiro** - APIs completas
2. ‚ùå **Ponto eletr√¥nico** - APIs completas
3. ‚ùå **Sistema de exporta√ß√£o** - PDF, Excel, CSV
4. ‚ùå **Sistema de notifica√ß√µes** - Push notifications

### **Fase 3 - Desej√°vel (3-4 semanas)**
1. ‚ùå **Integra√ß√µes** - E-mail, WhatsApp
2. ‚ùå **Sistema de relat√≥rios** - Gera√ß√£o autom√°tica
3. ‚ùå **Sistema de backup** - Backup autom√°tico
4. ‚ùå **Otimiza√ß√µes** - Cache, performance

## üìÅ **7. ESTRUTURA DE ARQUIVOS NECESS√ÅRIA**

```
backend-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ financeiro.js          ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ponto-eletronico.js    ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gruas.js               ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ obras.js               ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ funcionarios.js        ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientes.js            ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ estoque.js             ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notificacoes.js        ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exportar.js            ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ assinaturas.js         ‚ùå PENDENTE
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email.js               ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.js           ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ push-notifications.js  ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ relatorios.js         ‚ùå PENDENTE
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-funcionarios.js   ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-clientes.js       ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-obras.js          ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-gruas.js          ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-ponto.js          ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mock-financeiro.js     ‚ùå PENDENTE
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock-estoque.js        ‚ùå PENDENTE
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ backup.js              ‚ùå PENDENTE
‚îÇ       ‚îú‚îÄ‚îÄ cache.js               ‚ùå PENDENTE
‚îÇ       ‚îî‚îÄ‚îÄ logging.js              ‚ùå PENDENTE
‚îî‚îÄ‚îÄ database/
    ‚îî‚îÄ‚îÄ schema.sql                 ‚úÖ CRIADO
```

## ‚ö° **8. COMANDOS PARA EXECU√á√ÉO**

### **Instalar Depend√™ncias**
```bash
cd backend-api
npm install
```

### **Configurar Banco de Dados**
```bash
# PostgreSQL
createdb sistema_gruas
psql sistema_gruas < database/schema.sql
```

### **Executar Servidor**
```bash
npm run dev
```

## üéØ **9. PRIORIDADES DE IMPLEMENTA√á√ÉO**

### **üî¥ CR√çTICO (Implementar primeiro)**
1. APIs b√°sicas de CRUD
2. Dados mockados completos
3. Sistema de autentica√ß√£o
4. Banco de dados funcional

### **üü° IMPORTANTE (Implementar em seguida)**
1. Sistema financeiro
2. Ponto eletr√¥nico
3. Sistema de exporta√ß√£o
4. Notifica√ß√µes

### **üü¢ DESEJ√ÅVEL (Implementar por √∫ltimo)**
1. Integra√ß√µes externas
2. Sistema de backup
3. Otimiza√ß√µes
4. Relat√≥rios avan√ßados

## üìä **10. ESTIMATIVA DE TEMPO**

- **APIs B√°sicas:** 1-2 semanas
- **Dados Mockados:** 3-5 dias
- **Sistema Financeiro:** 1 semana
- **Ponto Eletr√¥nico:** 1 semana
- **Sistema de Exporta√ß√£o:** 1 semana
- **Notifica√ß√µes:** 1 semana
- **Integra√ß√µes:** 2 semanas

**Total Estimado:** 6-8 semanas

## ‚úÖ **11. CHECKLIST DE IMPLEMENTA√á√ÉO**

### **Banco de Dados**
- [x] Schema completo criado
- [ ] Migra√ß√µes executadas
- [ ] Dados iniciais inseridos
- [ ] √çndices criados
- [ ] Triggers funcionando

### **APIs**
- [ ] CRUD Funcion√°rios
- [ ] CRUD Clientes
- [ ] CRUD Obras
- [ ] CRUD Gruas
- [ ] CRUD Estoque
- [ ] Sistema Financeiro
- [ ] Ponto Eletr√¥nico
- [ ] Notifica√ß√µes
- [ ] Exporta√ß√£o
- [ ] Assinaturas

### **Dados Mockados**
- [ ] Funcion√°rios (50+ registros)
- [ ] Clientes (20+ registros)
- [ ] Obras (30+ registros)
- [ ] Gruas (15+ registros)
- [ ] Registros de Ponto (500+ registros)
- [ ] Dados Financeiros (100+ registros)
- [ ] Estoque (100+ itens)
- [ ] Notifica√ß√µes (50+ registros)

### **Integra√ß√µes**
- [ ] Sistema de E-mail
- [ ] WhatsApp Business
- [ ] Notifica√ß√µes Push
- [ ] Geolocaliza√ß√£o
- [ ] Backup Autom√°tico

---

## üö® **STATUS ATUAL: BACKEND 20% COMPLETO**

**Pr√≥ximos Passos:**
1. Implementar APIs b√°sicas
2. Criar dados mockados
3. Configurar banco de dados
4. Testar integra√ß√£o frontend-backend
